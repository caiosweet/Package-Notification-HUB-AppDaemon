type: custom:vertical-stack-in-card
cards:
  - type: custom:paper-buttons-row
    styles:
      background: var(--primary-color)
    buttons:
      - entity: sensor.notifier_config
        styles:
          button:
            font-size: 16px
            color: var(--primary-text-color)
        tap_action:
          action: navigate
          navigation_path: centro-notifiche
        icon: mdi:account-tie
        name: '{{ states(config.entity) }}'
  - type: conditional
    conditions:
      - entity: sensor.notifier_debug_error
        state_not: 'on'
      - entity: sensor.notifier_debug_error
        state_not: OK
    card:
      type: markdown
      card_mod:
        style: |
          ha-markdown.no-header {
            padding: 0px !important;
          }
      content: |-
        <ha-alert alert-type="error">
          <details>
            <summary>Notifier Debug Error</summary>
            {{states('sensor.notifier_debug_error')}}
        </details>
  - type: custom:paper-buttons-row
    styles:
      display: flex
      justify-content: space-between
    buttons:
      - entity: binary_sensor.notifier_people_home
        layout: state
        state:
          attribute: number
      - entity: group.notifier_location_tracker
        layout: icon
        styles:
          button:
            margin-left: '-24px'
        tap_action:
          action: more-info
        state_icons:
          not_home: mdi:home-export-outline
          home: mdi:home-import-outline
        state_styles:
          not_home:
            button:
              color: red
          home:
            button:
              color: var(--state-person-home-color)
      - entity: input_boolean.notifier_speech_notifications
        layout: icon
        state_icons:
          'on': mdi:account-tie-voice
          'off': mdi:account-tie-voice-off
      - entity: input_boolean.notifier_text_notifications
        layout: icon
        state_icons:
          'off': mdi:cellphone-message-off
      - entity: input_boolean.notifier_screen_notifications
        layout: icon
        state_icons:
          'off': mdi:home-assistant
      - entity: input_boolean.notifier_guest_mode
        layout: icon
        state_icons:
          'on': mdi:account-multiple-plus
          'off': mdi:account-multiple-minus-outline
      - entity: input_boolean.notifier_priority_message
        layout: icon
        state_icons:
          'off': mdi:alarm-light-outline
      - entity: input_boolean.notifier_holidays
        layout: icon
  - type: divider
    style:
      background-color: var(--primary-color)
      height: 1px
  - type: custom:paper-buttons-row
    styles:
      display: grid
      grid-template-columns: repeat(4, 1fr)
      font-size: 0.9em
    buttons:
      - entity: sensor.notifier_debug_error
        layout: icon|name|state
        name: Notifier
        styles:
          button:
            justify-content: flex-start
            color: >-
              {{ iif(states(config.entity)|lower in ['on','ok'],  
              'var(--success-color)', 'var(--error-color)') }}
          icon:
            scale: 70%
        state: |
          {{ iif(states(config.entity)|lower in ['on','ok'],  
              states(config.entity), 'Error') }}
      - entity: sensor.notifier_day_period
        layout: state
        tap_action:
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: âŒš Orari priodo del giorno
              content:
                type: entities
                entities:
                  - input_datetime.notifier_start_early_morning
                  - input_datetime.notifier_start_morning
                  - input_datetime.notifier_start_afternoon
                  - input_datetime.notifier_start_evening
                  - input_datetime.notifier_start_night
                  - input_datetime.notifier_start_late_night
        icon: '{{state_attr(''sensor.notifier_day_period'',''icon'')}}'
      - entity: sensor.notifier_day_period_volume
        tap_action:
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: ðŸŽš Volumi
              content:
                type: entities
                entities:
                  - input_number.notifier_early_morning_volume
                  - input_number.notifier_morning_volume
                  - input_number.notifier_afternoon_volume
                  - input_number.notifier_evening_volume
                  - input_number.notifier_night_volume
                  - input_number.notifier_late_night_volume
                  - input_number.notifier_intercom_volume
        icon: '{{state_attr(''sensor.notifier_day_period_volume'',''icon'')}}'
        state: |
          {{states('sensor.notifier_day_period_volume')}}%
        name: VOL
        layout: name|state
      - entity: binary_sensor.notifier_dnd
        name: DND
        layout: name|state
        styles:
          button:
            - color: >-
                {{ iif(states(config.entity) == 'on',  'var(--warning-color)',
                '') }}
        state_icons:
          'on': mdi:minus-circle
          'off': mdi:minus-circle-off
        tap_action:
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: ðŸ”‡ Orari non disturbare
              content:
                type: entities
                entities:
                  - input_datetime.notifier_start_weekdays
                  - input_datetime.notifier_end_weekdays
                  - input_datetime.notifier_start_holidays
                  - input_datetime.notifier_end_holidays
  - type: custom:paper-buttons-row
    styles:
      display: grid
      grid-template-columns: repeat(4, 1fr)
      font-size: 0.9em
    buttons:
      - entity: input_boolean.notifier_alexa_switch
        layout: icon|name
        name: Alexa
        styles:
          button:
            justify-content: flex-start
            color: >-
              {{ iif(is_state('binary_sensor.notifier_alexa_speak', 'on'), 
              'var(--warning-color)', '') }}
            animation: >-
              {{ iif(is_state('binary_sensor.notifier_alexa_speak', 'on'), 
              'blink 1.5s linear infinite alternate', '') }}
          icon:
            scale: 70%
      - entity: select.notifier_player_alexa
        tap_action:
          action: call-service
          service: select.select_next
          target:
            entity_id: select.notifier_player_alexa
          data:
            cycle: true
        double_tap_action:
          action: call-service
          service: select.select_first
          target:
            entity_id: select.notifier_player_alexa
        layout: state
        state:
          case: first
        state_icons:
          'on': mdi:minus-circle
          'off': mdi:minus-circle-off
        styles:
          button:
            color: var(--primary-text-color)
      - entity: input_select.notifier_alexa_type
        layout: state
        state:
          case: first
        state_styles:
          announce:
            button:
              color: var(--paper-item-icon-active-color)
        styles:
          button:
            color: var(--primary-text-color)
        tap_action:
          action: call-service
          service: input_select.select_next
          service_data:
            entity_id: input_select.notifier_alexa_type
      - entity: input_boolean.notifier_alexa_ssml
        layout: name
        name: SSML
  - type: custom:paper-buttons-row
    styles:
      display: grid
      grid-template-columns: repeat(4, 1fr)
      font-size: 0.9em
    buttons:
      - entity: input_boolean.notifier_google_switch
        layout: icon|name
        name: Google
        styles:
          button:
            justify-content: flex-start
          icon:
            scale: 70%
      - entity: select.notifier_player_google
        tap_action:
          action: call-service
          service: select.select_next
          target:
            entity_id: select.notifier_player_google
          data:
            cycle: true
        double_tap_action:
          action: call-service
          service: select.select_first
          target:
            entity_id: select.notifier_player_google
        layout: state
        state:
          case: first
        styles:
          button:
            color: var(--primary-text-color)
      - entity: input_select.notifier_tts_notify
        layout: icon|state
        icon: false
        state_text:
          google say: Say
          google cloud: Cloud
          google assistant: Assistant
          reverso: Reverso
        styles:
          button:
            color: var(--primary-text-color)
        tap_action:
          action: call-service
          service: input_select.select_next
          service_data:
            entity_id: input_select.notifier_tts_notify
  - type: custom:paper-buttons-row
    styles:
      display: grid
      grid-template-columns: 1fr 1fr 2fr
      font-size: 0.9em
    buttons:
      - entity: input_boolean.notifier_phone_notifications
        layout: icon|name
        name: Voip
        styles:
          button:
            justify-content: flex-start
          icon:
            scale: 70%
      - entity: input_select.notifier_phone_notify
        name: Voip
        layout: state
        state:
          case: first
        styles:
          button:
            color: var(--primary-text-color)
      - entity: group.notifier_player_alexa
        layout: name|state
        styles:
          button:
            color: var(--info-color)
            justify-content: flex-start
          icon:
            scale: 70%
        name: >
          {{ state_attr(config.entity, 'entity_id') |map('state_attr',
          'friendly_name') | join(', ') }}
        state: >
          {{ state_attr(config.entity, 'entity_id') |map('state_attr',
          'volume_level') | join(', ') }}
  - type: divider
    style:
      background-color: var(--primary-color)
      height: 1px
  - type: custom:paper-buttons-row
    styles:
      display: flex
      justify-content: space-between
      font-size: 0.9em
    buttons:
      - entity: select.notifier_text_notify
        tap_action:
          action: call-service
          service: select.select_next
          target:
            entity_id: select.notifier_text_notify
          data:
            cycle: true
        double_tap_action:
          action: call-service
          service: select.select_first
          target:
            entity_id: select.notifier_text_notify
        layout: icon|name|state
        name: Notify
        state:
          case: first
        styles:
          state:
            color: var(--primary-text-color)
      - entity: input_boolean.notifier_html_mode
        icon: |
          {{ iif(is_state(config.entity, 'off'), 'mdi:language-markdown', '') }}
        layout: icon
      - entity: input_boolean.notifier_wrap_text
        icon: |
          {{ iif(is_state(config.entity, 'off'), 'mdi:text-long', '') }}
        layout: icon
      - entity: input_boolean.notifier_tts_clock
        layout: icon
  - type: divider
    style:
      background-color: var(--primary-color)
      height: 1px
  - type: entities
    card_mod:
      style: |
        ha-card {
          background:none; border-radius: 0px; box-shadow: none; 
        }
        .card-content {padding: 0px; margin: 0;}
    entities:
      - type: custom:fold-entity-row
        cickable: true
        head:
          entity: button.notifier_last_message
          state_color: true
          name: Interfono
          tap_action:
            action: toggle
          extend_paper_buttons_row:
            hide_state: true
            position: right
            buttons:
              - entity: input_boolean.notifier_last_message
                layout: icon|name
                state_styles:
                  'on':
                    ripple:
                      color: var(--accent-color)
                    button:
                      background-color: var(--table-row-alternative-background-color)
        entities:
          - type: custom:lovelace-multiline-text-input-card
            card_mod:
              style: |
                ha-card {
                  background:none; border-radius: 0px; box-shadow: none; 
                  color: var(--primary-text-color);
                }
                textarea.textarea {margin: 0;}
                .card-content {padding-left: 0px;padding-top: 0px; }
            entity: input_text.notifier_intercom_message
            max_length: 255
            min_length: 1
            placeholder_text: Messaggio da inviare...
            title: ''
            buttons:
              save: true
              paste: true
              clear: true
            icons:
              save: mdi:send
              paste: mdi:content-paste
              clear: mdi:delete-forever
          - type: custom:paper-buttons-row
            styles:
              display: flex
              justify-content: space-between
            buttons:
              - entity: input_number.notifier_intercom_volume
                layout: icon|name
              - icon: mdi:volume-minus
                tap_action:
                  action: call-service
                  service: input_number.decrement
                  service_data:
                    entity_id: input_number.notifier_intercom_volume
              - entity: input_number.notifier_intercom_volume
                layout: state
                state: |
                  {{ states('input_number.notifier_intercom_volume')|int(0) }}%
              - icon: mdi:volume-plus
                tap_action:
                  action: call-service
                  service: input_number.increment
                  service_data:
                    entity_id: input_number.notifier_intercom_volume
